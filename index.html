<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LeanBuild RaR Console</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            navy: '#0a1628',
            purple: '#8e6cfa',
            cyan: '#06b6d4',
            amber: '#f59e0b'
          }
        }
      }
    }
  </script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f8fafc;
    }
    
    /* Ensure proper iframe sizing */
    #root {
      min-height: 100vh;
    }
    
    /* Override default link/button focus for iframe context */
    *:focus {
      outline: 2px solid #06b6d4;
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { 
      AlertTriangle, 
      Clock, 
      TrendingDown, 
      TrendingUp, 
      Calendar,
      DollarSign,
      Eye,
      Bell,
      ArrowUp,
      ArrowDown,
      CheckCircle2
    } = lucide;

    // Utility function for class merging
    function cn(...classes) {
      return classes.filter(Boolean).join(' ');
    }

    // Simplified UI Components
    const Card = ({ className, children, ...props }) => (
      <div className={cn("rounded-lg border bg-white shadow-sm", className)} {...props}>
        {children}
      </div>
    );

    const CardHeader = ({ className, children, ...props }) => (
      <div className={cn("flex flex-col space-y-1.5 p-6", className)} {...props}>
        {children}
      </div>
    );

    const CardTitle = ({ className, children, ...props }) => (
      <h3 className={cn("text-2xl font-semibold leading-none tracking-tight", className)} {...props}>
        {children}
      </h3>
    );

    const CardContent = ({ className, children, ...props }) => (
      <div className={cn("p-6 pt-0", className)} {...props}>
        {children}
      </div>
    );

    const Badge = ({ className, variant = 'default', children, ...props }) => {
      const variants = {
        default: "bg-blue-100 text-blue-800",
        secondary: "bg-gray-100 text-gray-800",
        destructive: "bg-red-100 text-red-800",
        outline: "border border-gray-300 text-gray-700"
      };
      
      return (
        <span className={cn("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold", variants[variant], className)} {...props}>
          {children}
        </span>
      );
    };

    const Button = ({ className, variant = 'default', size = 'default', children, ...props }) => {
      const variants = {
        default: "bg-blue-600 text-white hover:bg-blue-700",
        outline: "border border-gray-300 bg-white hover:bg-gray-50"
      };
      
      const sizes = {
        default: "h-10 px-4 py-2",
        sm: "h-9 px-3 text-sm"
      };
      
      return (
        <button 
          className={cn(
            "inline-flex items-center justify-center gap-2 rounded-md font-medium transition-colors",
            variants[variant],
            sizes[size],
            className
          )} 
          {...props}
        >
          {children}
        </button>
      );
    };

    const Progress = ({ value = 0, className, ...props }) => (
      <div className={cn("relative h-4 w-full overflow-hidden rounded-full bg-gray-200", className)} {...props}>
        <div 
          className="h-full bg-blue-600 transition-all"
          style={{ width: `${value}%` }}
        />
      </div>
    );

    const Alert = ({ className, children, ...props }) => (
      <div className={cn("relative w-full rounded-lg border p-4", className)} {...props}>
        {children}
      </div>
    );

    const AlertDescription = ({ className, children, ...props }) => (
      <div className={cn("text-sm", className)} {...props}>
        {children}
      </div>
    );

    // Main RaR Console Component
    function RaRConsole() {
      const [sliderValue, setSliderValue] = useState(12);
      const [overallScore, setOverallScore] = useState(73);

      const calculateImpact = () => {
        const daysEarlier = sliderValue;
        const cashImpact = Math.round(33200 * (daysEarlier / 12));
        const scoreImprovement = Math.round(7 * (daysEarlier / 12));
        return { cashImpact, scoreImprovement };
      };

      const { cashImpact, scoreImprovement } = calculateImpact();

      const calendarDays = [
        { day: 'M', date: 1, status: 'good' },
        { day: 'T', date: 2, status: 'critical' },
        { day: 'W', date: 3, status: 'warning' },
        { day: 'T', date: 4, status: 'good' },
        { day: 'F', date: 5, status: 'good' },
        { day: 'S', date: 6, status: 'warning' },
        { day: 'S', date: 7, status: 'good' }
      ];

      const getStatusColor = (status) => {
        switch (status) {
          case 'critical': return 'bg-red-500';
          case 'warning': return 'bg-yellow-500';
          case 'good': return 'bg-green-500';
          default: return 'bg-gray-300';
        }
      };

      return (
        <div className="p-6 space-y-6 bg-gray-50">
          {/* Summary Header */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <Card className="bg-gradient-to-r from-blue-50 to-blue-100 border-blue-200">
              <CardContent className="p-4">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-sm text-blue-600 font-medium">Overall RaR Score</p>
                    <p className="text-2xl font-bold text-blue-900">{overallScore}</p>
                  </div>
                  <TrendingUp className="h-8 w-8 text-blue-600" />
                </div>
                <Progress value={overallScore} className="mt-2" />
              </CardContent>
            </Card>

            <Card>
              <CardContent className="p-4">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-sm text-gray-600">Total at Risk</p>
                    <p className="text-2xl font-bold text-red-600">$77.3K</p>
                  </div>
                  <DollarSign className="h-8 w-8 text-red-500" />
                </div>
                <div className="flex items-center mt-2 text-sm">
                  <ArrowUp className="h-4 w-4 text-red-500 mr-1" />
                  <span className="text-red-600">+$14K from last week</span>
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardContent className="p-4">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-sm text-gray-600">Active Blind Spots</p>
                    <p className="text-2xl font-bold text-orange-600">3</p>
                  </div>
                  <Eye className="h-8 w-8 text-orange-500" />
                </div>
                <Badge variant="secondary" className="mt-2">2 Critical</Badge>
              </CardContent>
            </Card>

            <Card>
              <CardContent className="p-4">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-sm text-gray-600">Avg Payment Delay</p>
                    <p className="text-2xl font-bold text-yellow-600">47d</p>
                  </div>
                  <Clock className="h-8 w-8 text-yellow-500" />
                </div>
                <div className="flex items-center mt-2 text-sm">
                  <ArrowDown className="h-4 w-4 text-green-500 mr-1" />
                  <span className="text-green-600">-5d improvement</span>
                </div>
              </CardContent>
            </Card>
          </div>

          {/* Main Dashboard */}
          <div className="grid grid-cols-1 gap-6 md:grid-cols-3">
            
            {/* Panel 1: Cash Flow Blind Spots */}
            <Card className="col-span-1 md:col-span-1">
              <CardHeader className="pb-4">
                <div className="flex items-center space-x-2">
                  <AlertTriangle className="h-5 w-5 text-orange-500" />
                  <CardTitle className="text-lg">Cash Flow Blind Spots</CardTitle>
                </div>
              </CardHeader>
              <CardContent className="space-y-4">
                
                <div>
                  <div className="text-sm font-medium mb-3">Accounts Overview</div>
                  <div className="grid grid-cols-1 gap-2 text-xs">
                    <div className="bg-red-50 border border-red-200 p-2 rounded flex justify-between items-center">
                      <span>AR Aging</span>
                      <Badge variant="destructive" className="text-xs">Critical</Badge>
                    </div>
                    <div className="bg-yellow-50 border border-yellow-200 p-2 rounded flex justify-between items-center">
                      <span>Pending Pay Apps</span>
                      <Badge variant="secondary" className="text-xs">3 Pending</Badge>
                    </div>
                    <div className="bg-green-50 border border-green-200 p-2 rounded flex justify-between items-center">
                      <span>Retainage Release</span>
                      <Badge variant="outline" className="text-xs">On Track</Badge>
                    </div>
                  </div>
                </div>

                <div>
                  <div className="flex items-center space-x-2 mb-3">
                    <Calendar className="h-4 w-4" />
                    <div className="text-sm font-medium">Heat Map Calendar</div>
                  </div>
                  
                  <div className="grid grid-cols-7 gap-1 mb-3">
                    {calendarDays.map((day, index) => (
                      <div key={index} className="text-center">
                        <div className="text-xs text-gray-500 mb-1">{day.day}</div>
                        <div className={cn("w-8 h-8 rounded flex items-center justify-center text-white text-xs font-medium", getStatusColor(day.status))}>
                          {day.date}
                        </div>
                      </div>
                    ))}
                  </div>

                  <Alert className="border-red-200 bg-red-50">
                    <AlertTriangle className="h-4 w-4 text-red-600 inline mr-2" />
                    <AlertDescription className="text-sm inline">
                      <strong>July 2:</strong> Missing data from Subcontractor X
                    </AlertDescription>
                  </Alert>
                </div>

                <div className="flex justify-between items-center pt-2 border-t">
                  <div className="text-xs text-red-600 font-medium">
                    Blind Spot Impact: -10 RaR points
                  </div>
                  <Button size="sm" variant="outline">
                    <Bell className="h-4 w-4 mr-1" />
                    Set Alert
                  </Button>
                </div>
              </CardContent>
            </Card>

            {/* Panel 2: Payment Delays */}
            <Card className="col-span-1 md:col-span-1">
              <CardHeader className="pb-4">
                <div className="flex items-center space-x-2">
                  <Clock className="h-5 w-5 text-red-500" />
                  <CardTitle className="text-lg">Payment Delays</CardTitle>
                </div>
              </CardHeader>
              <CardContent className="space-y-4">
                
                <div>
                  <div className="text-sm font-medium mb-3">Overdue Invoices</div>
                  <div className="space-y-3">
                    <Card className="border-red-200 bg-red-50">
                      <CardContent className="p-3">
                        <div className="flex justify-between items-start mb-2">
                          <div className="text-sm font-medium">Invoice #2023-41</div>
                          <Badge variant="destructive" className="text-xs">61 Days</Badge>
                        </div>
                        <div className="text-lg font-bold text-red-600 mb-2">$63,000</div>
                        <div className="flex justify-between items-center">
                          <span className="text-xs text-gray-600">Owner rejected Line Item 5</span>
                          <Button size="sm" variant="outline">Follow Up</Button>
                        </div>
                      </CardContent>
                    </Card>

                    <Card className="border-yellow-200 bg-yellow-50">
                      <CardContent className="p-3">
                        <div className="flex justify-between items-start mb-2">
                          <div className="text-sm font-medium">Invoice #2023-52</div>
                          <Badge variant="secondary" className="text-xs">32 Days</Badge>
                        </div>
                        <div className="text-lg font-bold text-yellow-600 mb-2">$14,300</div>
                        <div className="flex justify-between items-center">
                          <span className="text-xs text-gray-600">Pending review</span>
                          <Button size="sm" variant="outline">Contact</Button>
                        </div>
                      </CardContent>
                    </Card>
                  </div>
                </div>

                <div className="flex justify-between items-center pt-2 border-t">
                  <div className="text-xs text-red-600 font-medium">
                    Delay Penalty: -6.1 RaR points
                  </div>
                  <div className="text-xs text-gray-500">
                    Avg: 47 days
                  </div>
                </div>
              </CardContent>
            </Card>

            {/* Panel 3: Risk Anticipation Shortfalls */}
            <Card className="col-span-1 md:col-span-1">
              <CardHeader className="pb-4">
                <div className="flex items-center space-x-2">
                  <TrendingDown className="h-5 w-5 text-purple-500" />
                  <CardTitle className="text-lg">Risk Anticipation</CardTitle>
                </div>
              </CardHeader>
              <CardContent className="space-y-4">
                
                <div>
                  <div className="text-sm font-medium mb-3">Recent Shortfall</div>
                  <Alert className="border-orange-200 bg-orange-50">
                    <AlertTriangle className="h-4 w-4 text-orange-600 inline mr-2" />
                    <AlertDescription className="text-sm inline">
                      <strong>Retainage Alert:</strong> Fired 12 days too late
                      <div className="text-xs text-gray-600 mt-1">
                        Cost: $33,200 in delayed cash flow
                      </div>
                    </AlertDescription>
                  </Alert>
                </div>

                <div>
                  <div className="text-sm font-medium mb-3">What If Simulation</div>
                  <div className="space-y-3">
                    <div>
                      <div className="flex justify-between text-xs text-gray-600 mb-1">
                        <span>Alert {sliderValue} days earlier</span>
                        <span>Current: 12 days late</span>
                      </div>
                      <input 
                        type="range"
                        min="0"
                        max="30"
                        value={sliderValue}
                        onChange={(e) => setSliderValue(parseInt(e.target.value))}
                        className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
                      />
                    </div>

                    <Card className="bg-green-50 border-green-200">
                      <CardContent className="p-3">
                        <div className="text-sm font-medium text-green-800 mb-1">
                          Projected Impact
                        </div>
                        <div className="grid grid-cols-2 gap-2 text-xs">
                          <div>
                            <div className="text-gray-600">RaR Score</div>
                            <div className="font-bold text-green-600">+{scoreImprovement}</div>
                          </div>
                          <div>
                            <div className="text-gray-600">Cash Impact</div>
                            <div className="font-bold text-green-600">+${cashImpact.toLocaleString()}</div>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  </div>
                </div>

                <div className="space-y-2">
                  <Button className="w-full" variant="default">
                    <CheckCircle2 className="h-4 w-4 mr-2" />
                    Enable Smart Alerts
                  </Button>
                  <Button className="w-full" variant="outline">
                    Configure Automation
                  </Button>
                </div>

                <div className="text-xs text-purple-600 font-medium pt-2 border-t">
                  Potential RaR Gain: +{scoreImprovement} points
                </div>
              </CardContent>
            </Card>
          </div>
        </div>
      );
    }

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<RaRConsole />);
  </script>
</body>
</html>
